#!/usr/bin/env ruby
require_relative "../config/environment"

port = ENV.fetch("SMTP_PORT", 587).to_i
host = ENV.fetch("SMTP_HOST", "0.0.0.0")
tls_cert = ENV["SMTP_TLS_CERT"]
tls_key = ENV["SMTP_TLS_KEY"]

if tls_cert && tls_key
  puts "Starting Loopy SMTP server on #{host}:#{port} with STARTTLS..."
else
  puts "Starting Loopy SMTP server on #{host}:#{port} (no TLS)..."
end

server = LoopySmtpServer.new(port: port, host: host, tls_cert: tls_cert, tls_key: tls_key)

trap("INT") { server.stop }
trap("TERM") { server.stop }

server.start
server.join
